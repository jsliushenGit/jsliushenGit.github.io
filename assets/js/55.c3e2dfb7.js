(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{404:function(s,t,a){"use strict";a.r(t);var n=a(16),l=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。状态模式的关键是区分事物内部的状态，事物内部状态的改变往往会带来事物的行为改变。")])]),s._v(" "),a("h2",{attrs:{id:"案例：电灯程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例：电灯程序"}},[s._v("#")]),s._v(" 案例：电灯程序")]),s._v(" "),a("p",[s._v("有一个电灯，电灯上面只有一个开关。当电灯开着的时候，此时按下开关，电灯会切换到关闭状态; 再按一次开关，电灯又将被打开。同一个开关按钮，在不同 的状态下，表现出来的行为是不一样的")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",[a("code",{staticClass:"language-JavaScript"},[a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" Light = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{ \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".state = "),a("span",{staticClass:"hljs-string"},[s._v("'off'")]),s._v("; "),a("span",{staticClass:"hljs-comment"},[s._v("// 给电灯设置初始状态 off")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";"),a("span",{staticClass:"hljs-comment"},[s._v("// 电灯开关按钮")]),s._v("\n}\n\nLight.prototype.init = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" button = "),a("span",{staticClass:"hljs-built_in"},[s._v("document")]),s._v(".createElement("),a("span",{staticClass:"hljs-string"},[s._v("'button'")]),s._v("),\n  self = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(";\n  button.innerHTML = "),a("span",{staticClass:"hljs-string"},[s._v("'开关'")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button = "),a("span",{staticClass:"hljs-built_in"},[s._v("document")]),s._v(".body.appendChild(button)\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button.onclick = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n    self.buttonWasPressed()\n  }\n}\n\nLight.prototype.buttonWasPressed = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{ \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".state === "),a("span",{staticClass:"hljs-string"},[s._v("'off'")]),s._v(") {\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("'开灯'")]),s._v(");\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".state = "),a("span",{staticClass:"hljs-string"},[s._v("'on'")]),s._v(";\n  } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".state === "),a("span",{staticClass:"hljs-string"},[s._v("'on'")]),s._v("){\n    "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("'关灯'")]),s._v(");\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".state = "),a("span",{staticClass:"hljs-string"},[s._v("'off'")]),s._v("; \n  }\n};\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" light = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Light(); \nlight.init();\n")])])]),a("p",[s._v("以上代码存在以下问题：")]),s._v(" "),a("ul",[a("li",[s._v("buttonWasPressed方法违反开放-封闭原则，每次新增或者修改light的状态，都需要改动buttonWasPressed方法中的代码")]),s._v(" "),a("li",[s._v("所有跟状态有关的行为，都被封装在buttonWasPressed方法里，如果以后这个电灯又增加了强强光、超强光和终极强光，我们将无法预测这个方法将膨胀到什么底部")]),s._v(" "),a("li",[s._v("状态的切换非常不明显，仅仅表现为对state变量的赋值，这样的操作很容易被程序员不小心漏掉")]),s._v(" "),a("li",[s._v("buttonWasPressed方法里堆砌大量的if-else语句，使得它难以阅读和维护")])]),s._v(" "),a("p",[s._v("状态模式重构")]),s._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",[a("code",{staticClass:"language-JavaScript"},[a("span",{staticClass:"hljs-comment"},[s._v("/******************** 定义 3 个状态类 ************************/")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// OffLightState:")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" OffLightState = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("light")]),s._v(") ")]),s._v("{ \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light = light;\n}\n\nOffLightState.prototype.buttonWasPressed = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{ \n  "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("'弱光'")]),s._v("); "),a("span",{staticClass:"hljs-comment"},[s._v("// offLightState 对应的行为 ")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light.setState("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light.weakLightState);"),a("span",{staticClass:"hljs-comment"},[s._v("// 切换状态到 weakLightState")]),s._v("\n};\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// WeakLightState:")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" WeakLightState = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("light")]),s._v(")")]),s._v("{ \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light = light;\n}\n\nWeakLightState.prototype.buttonWasPressed = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{ \n  "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("'强光'")]),s._v("); "),a("span",{staticClass:"hljs-comment"},[s._v("// weakLightState 对应的行为 ")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light.setState("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light.strongLightState); "),a("span",{staticClass:"hljs-comment"},[s._v("//切换状态到strongLightState")]),s._v("\n};\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("// StrongLightState:")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" StrongLightState = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("light")]),s._v(") ")]),s._v("{ \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light = light;\n}\n\nStrongLightState.prototype.buttonWasPressed = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),a("span",{staticClass:"hljs-string"},[s._v("'关灯'")]),s._v("); "),a("span",{staticClass:"hljs-comment"},[s._v("// strongLightState 对应的行为")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light.setState("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".light.offLightState); "),a("span",{staticClass:"hljs-comment"},[s._v("// 切换状态到 offLightState")]),s._v("\n}\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("/******************* 改写 Light 类，使用状态对象记录当前的状态 ******************/")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" Light = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".offLightState = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" OffLightState("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("); \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".weakLightState = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" WeakLightState("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("); \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".strongLightState = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" StrongLightState("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("); \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";\n}\n\n"),a("span",{staticClass:"hljs-comment"},[s._v("/******************** 提供一个 方法来切换 light 对象的状态 ************************/")]),s._v("\nLight.prototype.init = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" button = "),a("span",{staticClass:"hljs-built_in"},[s._v("document")]),s._v(".createElement("),a("span",{staticClass:"hljs-string"},[s._v("'button'")]),s._v("),\n  self = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(";\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button = "),a("span",{staticClass:"hljs-built_in"},[s._v("document")]),s._v(".body.appendChild(button); \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button.innerHTML = "),a("span",{staticClass:"hljs-string"},[s._v("'开关'")]),s._v(";\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".currState = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".offLightState;\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".button.onclick = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{ \n    self.currState.buttonWasPressed();\n  } \n}\n\nLight.prototype.setState = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),a("span",{staticClass:"hljs-params"},[s._v("newState")]),s._v(")")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".currState = newState; \n};\n"),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" light = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Light(); \nlight.init();\n")])])]),a("p",[s._v("执行结果跟之前的代码一致，但是使用状态模式的好处很明显，它可以使每一种状态和它对应的行为之间的关系局部化，这些行为被分散和封装在各自对应的状态类之中，便于阅读和管理代码。\n另外，状态之间的切换都被分布在状态类内部，这使得我们无需编写过多的 if、else 条件 分支语言来控制状态之间的转换。")]),s._v(" "),a("h2",{attrs:{id:"状态模式的优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#状态模式的优缺点"}},[s._v("#")]),s._v(" 状态模式的优缺点")]),s._v(" "),a("p",[s._v("优点：")]),s._v(" "),a("ul",[a("li",[s._v("状态模式定义了状态与行为之间的关系，并将它们封装在一个类里。通过增加新的状态 类，很容易增加新的状态和转换。")]),s._v(" "),a("li",[s._v("避免 Context 无限膨胀，状态切换的逻辑被分布在状态类中，也去掉了 Context 中原本过 5 多的条件分支。")]),s._v(" "),a("li",[s._v("用对象代替字符串来记录当前状态，使得状态的切换更加一目了然。")]),s._v(" "),a("li",[s._v("Context 中的请求动作和状态类中封装的行为可以非常容易地独立变化而互不影响")])]),s._v(" "),a("p",[s._v("缺点：状态模式会在系统中定义许多状态类，编写大量的状态类是一想枯燥乏味的工作，而且系统中会因此而增加不少对象")]),s._v(" "),a("h2",{attrs:{id:"状态模式和策略模式的关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#状态模式和策略模式的关系"}},[s._v("#")]),s._v(" 状态模式和策略模式的关系")]),s._v(" "),a("p",[s._v("状态模式和策略模式的相同点是，它们都有一个上下文，一些策略或者状态类，上下文把请求委托给这些类来执行。"),a("br"),s._v("\n它们之间的区别是策略模式中的各个策略类之间是平等又平行的，它们之间没有任何联系，所有客户必须熟知所有的策略类，以便客户可以随时主动切换算法。在状态模式中，状态和对应的行为是早已被封装好的，状态之间的切换也早被规定完成，“改变行为”这件事情发生在状态模式内部。")])])}),[],!1,null,null,null);t.default=l.exports}}]);