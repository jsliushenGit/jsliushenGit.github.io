(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{409:function(s,a,t){"use strict";t.r(a);var l=t(16),n=Object(l.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("定义")]),s._v(" "),t("p",[s._v("享元模式是一种用于性能优化的模式。享元模式的核心是运用共享技术来有效支持大量细粒度的对象。")])]),s._v(" "),t("h2",{attrs:{id:"案例：模特穿衣"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例：模特穿衣"}},[s._v("#")]),s._v(" 案例：模特穿衣")]),s._v(" "),t("p",[s._v("某衣服工厂生产了50种男式衣服和50种女式衣服，现在需要塑料模特来穿上衣服拍照。正常情况下需要50个男模特和50个女模特，然后每人分别穿上衣服拍照。"),t("br"),s._v("\n传统实现思路：创建模特类，构造函数参数为性别sex和衣服underwear。然后循环100次，实例化100个对象，然后分别用掉穿衣和拍照方法。"),t("br"),s._v("\n传统实现思路的问题在于对象爆炸，如果有1000套衣服，那就会实例化1000个对象，程序可能会因为对象太多而崩溃。"),t("br"),s._v("\n享元模式实现思路：虽然有100种衣服，但是拍照只需要男女模特各一个就足够了。把衣服underwear参数从构造函数中移除，构造函数只接收sex参数。")]),s._v(" "),t("div",{staticClass:"language-JavaScript extra-class"},[t("pre",[t("code",{staticClass:"language-JavaScript"},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" Model = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("sex")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".sex = sex\n}\n\nModel.prototype.takePhoto = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v("'sex='")]),s._v(" + "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".sex + "),t("span",{staticClass:"hljs-string"},[s._v("'underwear='")]),s._v(" + "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".underwear)\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" maleModel = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Model("),t("span",{staticClass:"hljs-string"},[s._v("'male'")]),s._v(")\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" femalModel = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Model("),t("span",{staticClass:"hljs-string"},[s._v("'female'")]),s._v(")\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i <= "),t("span",{staticClass:"hljs-number"},[s._v("50")]),s._v("; i++) {\n  maleModel.underwear = "),t("span",{staticClass:"hljs-string"},[s._v("'underwear'")]),s._v(" + i\n  maleModel.takePhoto()\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i <= "),t("span",{staticClass:"hljs-number"},[s._v("50")]),s._v("; i++) {\n  femaleModel.underwear = "),t("span",{staticClass:"hljs-string"},[s._v("'underwear'")]),s._v(" + i\n  femaleModel.takePhoto()\n}\n")])])]),t("h2",{attrs:{id:"内部状态与外部状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内部状态与外部状态"}},[s._v("#")]),s._v(" 内部状态与外部状态")]),s._v(" "),t("p",[s._v("享元模式要求将对象的属性划分为内部状态与外部状态。享元模式的目标是尽量减少共享对象的数量。"),t("br"),s._v("\n区分内部状态和外呼状态")]),s._v(" "),t("ul",[t("li",[s._v("内部状态存储于对象内部")]),s._v(" "),t("li",[s._v("内部状态可以被一些对象共享")]),s._v(" "),t("li",[s._v("内部状态独立于具体的场景，通常不会改变")]),s._v(" "),t("li",[s._v("外部状态取决于具体的场景，并根据场景而变化，外部状态不能被共享。")])]),s._v(" "),t("p",[s._v("模特穿衣例子中，性别是内部状态，衣服是外部状态，通过区分这两种状态，大大减少了系统中的对象数量。")]),s._v(" "),t("h2",{attrs:{id:"案例：文件上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例：文件上传"}},[s._v("#")]),s._v(" 案例：文件上传")]),s._v(" "),t("p",[s._v("微云的文件上传功能可以选择队列，一个一个地排队上传，支持同时选择2000个文件。每一个文件都对应着一个JavaScript上传对象。如果创建2000个upload对象，chrome还能勉强支撑，IE肯定原地爆炸。\n享元模式实现")]),s._v(" "),t("div",{staticClass:"language-JavaScript extra-class"},[t("pre",[t("code",{staticClass:"language-JavaScript"},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" Upload = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("uploadType")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".uploadType = uploadType;\n}\n\nUpload.prototype.delFile = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("id")]),s._v(") ")]),s._v("{\n  uploadManager.setExternalState(id, "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(");\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fileSize < "),t("span",{staticClass:"hljs-number"},[s._v("3000")]),s._v(") {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".dom.parentNode.removeChild("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".dom);\n  }\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"hljs-built_in"},[s._v("window")]),s._v(".confirm("),t("span",{staticClass:"hljs-string"},[s._v('"确定要删除该文件吗？"')]),s._v(" + "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fileName)) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".dom.parentNode.removeChild("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".dom);\n  }\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" UploadFactory = ("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" createFlyWeightObjs = {};\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("create")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("uploadType")]),s._v(") ")]),s._v("{\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (createFlyWeightObjs[uploadType]) {\n        "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" createFlyWeightObjs[uploadType];\n      }\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" createFlyWeightObjs[uploadType] = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Upload(uploadType);\n    }\n  }\n})();\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" uploadManager = ("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" uploadDatabase = {};\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("add")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("id, uploadType, fileName, fileSize")]),s._v(") ")]),s._v("{\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" flyWeightObj = UploadFactory.create(uploadType);\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" dom = "),t("span",{staticClass:"hljs-built_in"},[s._v("document")]),s._v(".createElement("),t("span",{staticClass:"hljs-string"},[s._v('"div"')]),s._v(");\n      dom.innerHTML =\n        "),t("span",{staticClass:"hljs-string"},[s._v("`\n          <span>文件名称:"),t("span",{staticClass:"hljs-subst"},[s._v("${fileName}")]),s._v(",文件大小:"),t("span",{staticClass:"hljs-subst"},[s._v("${fileSize}")]),s._v("</span>\n          <button class='delFile'>删除</button>\n        `")]),s._v("\n      dom.querySelector("),t("span",{staticClass:"hljs-string"},[s._v('".delFile"')]),s._v(").onclick = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n        flyWeightObj.delFile(id);\n      }\n      "),t("span",{staticClass:"hljs-built_in"},[s._v("document")]),s._v(".body.appendChild(dom);\n\n      uploadDatabase[id] = {\n        "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": fileName,\n        "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": fileSize,\n        "),t("span",{staticClass:"hljs-attr"},[s._v("dom")]),s._v(": dom\n      }\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" flyWeightObj;\n    },\n\n    "),t("span",{staticClass:"hljs-attr"},[s._v("setExternalState")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("id, flyWeightObj")]),s._v(") ")]),s._v("{\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" uploadData = uploadDatabase[id];\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i "),t("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" uploadData) {\n        flyWeightObj[i] = uploadData[i];\n      }\n    }\n  }\n})()\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" id = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(";\n"),t("span",{staticClass:"hljs-built_in"},[s._v("window")]),s._v(".startUpload = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("uploadType, files")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(", file; file = files[i++];) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" uploadObj = uploadManager.add(++id, uploadType, file.fileName, file.fileSize);\n  }\n}\n\nstartUpload("),t("span",{staticClass:"hljs-string"},[s._v('"plugin"')]),s._v(", [{\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"1.txt"')]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": "),t("span",{staticClass:"hljs-number"},[s._v("1000")]),s._v("\n  },\n  {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"2.html"')]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": "),t("span",{staticClass:"hljs-number"},[s._v("3000")]),s._v("\n  },\n  {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"3.txt"')]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": "),t("span",{staticClass:"hljs-number"},[s._v("5000")]),s._v("\n  }\n]);\nstartUpload("),t("span",{staticClass:"hljs-string"},[s._v('"flash"')]),s._v(", [{\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"4.txt"')]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": "),t("span",{staticClass:"hljs-number"},[s._v("1000")]),s._v("\n  },\n  {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"5.html"')]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": "),t("span",{staticClass:"hljs-number"},[s._v("3000")]),s._v("\n  },\n  {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileName")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v('"6.txt"')]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("fileSize")]),s._v(": "),t("span",{staticClass:"hljs-number"},[s._v("5000")]),s._v("\n  },\n])\n")])])]),t("h2",{attrs:{id:"享元模式的适用性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#享元模式的适用性"}},[s._v("#")]),s._v(" 享元模式的适用性")]),s._v(" "),t("p",[s._v("享元模式带来的好处很大程度上取决于如何使用以及何时使用，一般来说，以下情况发生时便可以使用享元模式。")]),s._v(" "),t("ul",[t("li",[s._v("一个程序中使用了大量的相似对象")]),s._v(" "),t("li",[s._v("由于使用了大量对象，造成了很大的内存开销")]),s._v(" "),t("li",[s._v("对象的大多数状态都可以变为外部状态")])]),s._v(" "),t("h2",{attrs:{id:"对象池"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对象池"}},[s._v("#")]),s._v(" 对象池")]),s._v(" "),t("p",[s._v("对象池维护一个装载空闲对象的池子，如果需要对象的时候，不是直接new，而是转从对象池里获取。如果对象池里没有空闲对象，则创建一个新对象。")]),s._v(" "),t("p",[s._v("通用对象池的实现")]),s._v(" "),t("div",{staticClass:"language-JavaScript extra-class"},[t("pre",[t("code",{staticClass:"language-JavaScript"},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" objectPoolFactory = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("createObjFn")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" objectPool = []\n  \n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("create")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" obj = objectPool.length === "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(" ? createObjFn.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(") : objectPool.shift()\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" obj\n    },\n\n    "),t("span",{staticClass:"hljs-attr"},[s._v("recover")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("obj")]),s._v(") ")]),s._v("{\n      objectPool.push(obj)\n    }\n  }\n}\n")])])]),t("p",[s._v("对象池是另外一种性能优化方案，它跟享元模式有一些相似之处，但没有分离内部状态和外部状态这个过程。")]),s._v(" "),t("h2",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),t("p",[s._v("享元模式是为解决性能问题而生的模式，这跟大部分模式的诞生原因都不一样。在一个存在大量相似对象的系统中，享元模式可以很好的解决大量对象带来的性能问题。")])])}),[],!1,null,null,null);a.default=n.exports}}]);