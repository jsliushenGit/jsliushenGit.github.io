(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{379:function(s,a,n){"use strict";n.r(a);var t=n(16),l=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("在MDN中，new运算符的定义如下：")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("new 运算符创建一个用户定义的对象类型的实例或具有构造函数的内置对象的实例。")])]),s._v(" "),n("p",[s._v("从上面的定义中，我们很难看出一个函数在使用new运算符调用时究竟发生了什么。我们还是来看代码：")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("Person")]),s._v("("),n("span",{staticClass:"hljs-params"},[s._v("name, age")]),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n}\nPerson.prototype.sex = "),n("span",{staticClass:"hljs-string"},[s._v('"man"')]),s._v("\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = "),n("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Person("),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);   "),n("span",{staticClass:"hljs-comment"},[s._v("//zhangsan ")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);    "),n("span",{staticClass:"hljs-comment"},[s._v("//18")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.sex);    "),n("span",{staticClass:"hljs-comment"},[s._v("//man")]),s._v("\n")])])]),n("p",[s._v("了解过javascript继承的人都知道，在使用new调用的函数被称为构造函数，调用之后会产生一个新的对象，被成为实例对象。实例对象可以访问构造函数中的属性和原型对象中的属性。这里我们可以总结一下，使用new运算符调用函数的时候，会创建一个对象，然后把构造函数中的this指向这个新对象，把新对象和构造函数的prototype进行绑定，经过一系列处理之后，返回这个新对象。这是我们暂时的理解，再来看一段代码：")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("Person")]),s._v("("),n("span",{staticClass:"hljs-params"},[s._v("name, age")]),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n    "),n("span",{staticClass:"hljs-attr"},[s._v("a")]),s._v(": "),n("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(",\n    "),n("span",{staticClass:"hljs-attr"},[s._v("b")]),s._v(": "),n("span",{staticClass:"hljs-number"},[s._v("2")]),s._v("\n  }\n}\nPerson.prototype.sex = "),n("span",{staticClass:"hljs-string"},[s._v('"man"')]),s._v("\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = "),n("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Person("),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);   "),n("span",{staticClass:"hljs-comment"},[s._v("//undefined")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);    "),n("span",{staticClass:"hljs-comment"},[s._v("//undefined")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.sex);    "),n("span",{staticClass:"hljs-comment"},[s._v("//undefined")]),s._v("\n")])])]),n("p",[s._v("从上面的代码我们可以看出，当构造函数有指定返回值的时候，这个新创建的对象好像“失效”了，返回的是这个指定的返回值。这时候“实例对象”不能再访问构造函数和原型对象中的属性了。"),n("br"),s._v("\n还没完，再看一段代码：")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("Person")]),s._v("("),n("span",{staticClass:"hljs-params"},[s._v("name, age")]),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" “ab”\n}\nPerson.prototype.sex = "),n("span",{staticClass:"hljs-string"},[s._v('"man"')]),s._v("\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = "),n("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Person("),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);   "),n("span",{staticClass:"hljs-comment"},[s._v("//zhangsan")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);    "),n("span",{staticClass:"hljs-comment"},[s._v("//18")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.sex);    "),n("span",{staticClass:"hljs-comment"},[s._v("//name")]),s._v("\n")])])]),n("p",[s._v("通过上面的代码我们发现，当构造函数的指定返回值不是对象的时候，这个新创建的对象好像又“复活”了，具有了最开始时的特性。")]),s._v(" "),n("p",[s._v("那么这里我们来总结一下，当函数通过new运算符调用时，内部到底发生了什么")]),s._v(" "),n("ul",[n("li",[s._v("创建了一个新对象")]),s._v(" "),n("li",[s._v("构造函数中的this指向了这个对象")]),s._v(" "),n("li",[s._v("这个对象和构造函数的prototype进行了绑定")]),s._v(" "),n("li",[s._v("如果构造函数指定了对象类型的返回值，就不返回这个新创建的对象，返回指定的返回值")]),s._v(" "),n("li",[s._v("如果构造函数没有指定返回值或者指定了非对象类型的返回值，就返回这个新创建的对象")])]),s._v(" "),n("p",[s._v("下面我们根据上面的总结，一步一步来模拟实现new")]),s._v(" "),n("h2",{attrs:{id:"第一版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一版"}},[s._v("#")]),s._v(" 第一版")]),s._v(" "),n("p",[s._v("我们无法模拟运算符，这里我们通过工厂函数的方式来模拟new。传入构造函数作为参数，返回实例对象。来看代码：")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("myNew")]),s._v("("),n("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-comment"},[s._v("//传入的参数有多个，第一个参数是构造函数，后面的参数是传入构造函数的参数")]),s._v("\n  "),n("span",{staticClass:"hljs-comment"},[s._v("//这里使用shift来删除并获取arguments中的第一个值，也就是构造函数")]),s._v("\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" "),n("span",{staticClass:"hljs-keyword"},[s._v("constructor")]),s._v(" = Array.prototype.shift.call(arguments);\n  //创建新的对象\n  var newObj = {};\n  "),n("span",{staticClass:"hljs-comment"},[s._v("//将构造函数中的this指定为newObj，使用apply模拟")]),s._v("\n  "),n("span",{staticClass:"hljs-comment"},[s._v("//这里注意，直接传入arguments，因为在上面已经使用shift删除了第一个参数")]),s._v("\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("constructor")]),s._v(".apply(newObj, arguments);\n  //返回创建的对象\n  return newObj\n}\n\nfunction Person(name, age) {\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n}\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = myNew(Person, "),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);  "),n("span",{staticClass:"hljs-comment"},[s._v("//zhangsan")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);   "),n("span",{staticClass:"hljs-comment"},[s._v("//18")]),s._v("\n")])])]),n("p",[s._v("上面的代码有详细的注释，大家可以仔细查看，帮助理解。最终打印的值也是我们期望的结果。这里我们已经实现了部分功能，创建了新对象，将构造函数中的this指定为这个新对象，返回新对象。下面我们实现剩下的部分，绑定原型对象，给构造函数指定不同类型的返回值。")]),s._v(" "),n("h2",{attrs:{id:"第二版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第二版"}},[s._v("#")]),s._v(" 第二版")]),s._v(" "),n("p",[s._v("将实例对象绑定原型对象我们可以使用 _ "),n("em",[s._v("proto")]),s._v(" _ , 判断类型则使用 typeof.")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("myNew")]),s._v("("),n("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" "),n("span",{staticClass:"hljs-keyword"},[s._v("constructor")]),s._v(" = Array.prototype.shift.call(arguments);\n  var newObj = {};\n  "),n("span",{staticClass:"hljs-comment"},[s._v("//绑定原型对象")]),s._v("\n  newObj.__proto__ = "),n("span",{staticClass:"hljs-keyword"},[s._v("constructor")]),s._v(".prototype;\n  //接收返回值\n  var result = "),n("span",{staticClass:"hljs-keyword"},[s._v("constructor")]),s._v(".apply(newObj, arguments);\n  //根据返回值类型判断是返回newObj还是result\n  return typeof result === 'object' ? result : newObj\n}\n")])])]),n("p",[s._v("大家可以对照注释理解代码，如果有问题可以留言讨论。下面来测试一下")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("Person")]),s._v("("),n("span",{staticClass:"hljs-params"},[s._v("name, age")]),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n}\nPerson.prototype.sex = "),n("span",{staticClass:"hljs-string"},[s._v('"man"')]),s._v("\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = myNew(Person, "),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);      "),n("span",{staticClass:"hljs-comment"},[s._v("//zhangsan")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);       "),n("span",{staticClass:"hljs-comment"},[s._v("//18")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.sex);       "),n("span",{staticClass:"hljs-comment"},[s._v("//man")]),s._v("\n")])])]),n("p",[s._v("没有返回值的情况，通过验证！")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("Person")]),s._v("("),n("span",{staticClass:"hljs-params"},[s._v("name, age")]),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),n("span",{staticClass:"hljs-string"},[s._v('"ab"')]),s._v("\n}\nPerson.prototype.sex = "),n("span",{staticClass:"hljs-string"},[s._v('"man"')]),s._v("\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = myNew(Person, "),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);    "),n("span",{staticClass:"hljs-comment"},[s._v("//zhangsan")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);\t   "),n("span",{staticClass:"hljs-comment"},[s._v("//18")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.sex);     "),n("span",{staticClass:"hljs-comment"},[s._v("//man")]),s._v("\n")])])]),n("p",[s._v("有返回值，但是返回值为非对象类型的情况，通过验证！")]),s._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",[n("code",{staticClass:"language-javascript"},[n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),n("span",{staticClass:"hljs-title"},[s._v("Person")]),s._v("("),n("span",{staticClass:"hljs-params"},[s._v("name, age")]),s._v(") ")]),s._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".name = name;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".age = age;\n  "),n("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n    "),n("span",{staticClass:"hljs-attr"},[s._v("a")]),s._v(": "),n("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(",\n    "),n("span",{staticClass:"hljs-attr"},[s._v("b")]),s._v(": "),n("span",{staticClass:"hljs-number"},[s._v("2")]),s._v("\n  }\n}\nPerson.prototype.sex = "),n("span",{staticClass:"hljs-string"},[s._v('"man"')]),s._v("\n"),n("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" zhangsan = myNew(Person, "),n("span",{staticClass:"hljs-string"},[s._v('"zhangsan"')]),s._v(", "),n("span",{staticClass:"hljs-number"},[s._v("18")]),s._v(");\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.name);       "),n("span",{staticClass:"hljs-comment"},[s._v("//undefined")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.age);        "),n("span",{staticClass:"hljs-comment"},[s._v("//undefined")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.sex);        "),n("span",{staticClass:"hljs-comment"},[s._v("//undefined")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.a);          "),n("span",{staticClass:"hljs-comment"},[s._v("//1")]),s._v("\n"),n("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(zhangsan.b);          "),n("span",{staticClass:"hljs-comment"},[s._v("//2")]),s._v("\n")])])]),n("p",[s._v("有返回值，且返回值为对象类型的情况，通过验证！")])])}),[],!1,null,null,null);a.default=l.exports}}]);