(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{402:function(s,a,t){"use strict";t.r(a);var n=t(16),l=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("职责链模式的定义是: 使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理他们。")])]),s._v(" "),t("h2",{attrs:{id:"案例：定金优惠券"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例：定金优惠券"}},[s._v("#")]),s._v(" 案例：定金优惠券")]),s._v(" "),t("p",[s._v("某电商卖手机，用户可以先交定金，正式购买的时候会根据用户交的定金给用户返优惠券。支付过500元定金的用户会收到100元的优惠券，支付过200元定金的用户会收到50元的优惠券，没有支付过定金的不返优惠券，且在库存有限的情况下不一定保证能买到。")]),s._v(" "),t("p",[s._v("一般实现思路：根据用户支付的定金额度和库存做各种判断。虽然可以实现功能，但是代码难以阅读，而且维护起来很麻烦")]),s._v(" "),t("p",[s._v("职责链模式重构代码:")]),s._v(" "),t("div",{staticClass:"language-JavaScript extra-class"},[t("pre",[t("code",{staticClass:"language-JavaScript"},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" order500 = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("orderType, pay, stock")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (orderType == "),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(" && pay) {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"500元定金预购，得到100元优惠券"')]),s._v(");\n  } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(";\n  }\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" order200 = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("orderType, pay, stock")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (orderType == "),t("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(" && pay) {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"200元定金预购，得到50元优惠券"')]),s._v(");\n  } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(";\n  }\n}\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" orderNormal = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("orderType, pay, stock")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (stock > "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(") {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"普通购买，无优惠券"')]),s._v(");\n  } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"库存不足"')]),s._v(");\n  }\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" Chain = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("fn")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fn = fn;\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor = "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";\n}\n\nChain.prototype.setNextSuccessor = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("successor")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor = successor;\n}\n\nChain.prototype.passRequest = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" ret = "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fn.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (ret === "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(") {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor && "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor.passRequest.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor, "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n  }\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" ret;\n}\n"),t("span",{staticClass:"hljs-comment"},[s._v("//创建职责链的节点")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" chainOrder500 = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Chain(order500);\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" chainOrder200 = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Chain(order200);\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" chainOrderNormal = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Chain(orderNormal);\n"),t("span",{staticClass:"hljs-comment"},[s._v("//指定节点的执行顺序")]),s._v("\nchainOrder500.setNextSuccessor(chainOrder200);\nchainOrder200.setNextSuccessor(chainOrderNormal);\n\n"),t("span",{staticClass:"hljs-comment"},[s._v("//开始发起请求")]),s._v("\nchainOrder500.passRequest("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(");\nchainOrder500.passRequest("),t("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(");\nchainOrder500.passRequest("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(");\nchainOrder500.passRequest("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(");\n")])])]),t("h2",{attrs:{id:"异步的职责链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异步的职责链"}},[s._v("#")]),s._v(" 异步的职责链")]),s._v(" "),t("p",[s._v("节点中的处理是异步的，异步返回的结果决定请求是否流向下一个节点")]),s._v(" "),t("div",{staticClass:"language-JavaScript extra-class"},[t("pre",[t("code",{staticClass:"language-JavaScript"},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" Chain = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("fn")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fn = fn;\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor = "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(";\n}\n\nChain.prototype.setNextSuccessor = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("successor")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor = successor;\n}\n\nChain.prototype.passRequest = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" ret = "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fn.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (ret === "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(") {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor && "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor.passRequest.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor, "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n  }\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" ret;\n}\n\nChain.prototype.next="),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor && "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor.passRequest.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".successor,"),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n}\n\n"),t("span",{staticClass:"hljs-comment"},[s._v("//创建职责链的节点")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" fn1="),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Chain("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n  "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(");\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(";\n})\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" fn2="),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Chain("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n  "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(");\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" self = "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(";\n  setTimeout("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n    self.next();\n  },"),t("span",{staticClass:"hljs-number"},[s._v("2000")]),s._v(");\n})\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" fn3="),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Chain("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v("("),t("span",{staticClass:"hljs-params"}),s._v(")")]),s._v("{\n  "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-number"},[s._v("3")]),s._v(");\n})\n\nfn1.setNextSuccessor(fn2).setNextSuccessor(fn3);\nfn1.passRequest();\n")])])]),t("h2",{attrs:{id:"职责链模式的优缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#职责链模式的优缺点"}},[s._v("#")]),s._v(" 职责链模式的优缺点")]),s._v(" "),t("p",[s._v("优点")]),s._v(" "),t("ul",[t("li",[s._v("解耦了请求发送者和N个接收者之间的复杂关系")]),s._v(" "),t("li",[s._v("使用了职责链模式之后，链中的节点对象可以灵活的拆分重组。增加或者删除一个节点，或者改变节点在链中的位置都是轻而易举的事情。")])]),s._v(" "),t("p",[s._v("缺点：")]),s._v(" "),t("ul",[t("li",[s._v("不能保证请求一定会被链中的节点处理")]),s._v(" "),t("li",[s._v("可能链中的大部分节点并没有起到实质性的作用，它们的作用仅仅是让请求传递下去，从性能方面考虑，我们要避免过长的职责链带来的性能损耗。")])]),s._v(" "),t("h2",{attrs:{id:"用aop实现职责链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用aop实现职责链"}},[s._v("#")]),s._v(" 用AOP实现职责链")]),s._v(" "),t("p",[s._v("基于上面的代码，我们利用JavaScript的函数式特性，实现一种更方便的职责链模式")]),s._v(" "),t("div",{staticClass:"language-JavaScript extra-class"},[t("pre",[t("code",{staticClass:"language-JavaScript"},[t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" order500 = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("orderType, pay, stock")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (orderType == "),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(" && pay) {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"500元定金预购，得到100元优惠券"')]),s._v(");\n  } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(";\n  }\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" order200 = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("orderType, pay, stock")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (orderType == "),t("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(" && pay) {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"200元定金预购，得到50元优惠券"')]),s._v(");\n  } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(";\n  }\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" orderNormal = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("orderType, pay, stock")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (stock > "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(") {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"普通购买，无优惠券"')]),s._v(");\n  } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v('"库存不足"')]),s._v(");\n  }\n}\n\n"),t("span",{staticClass:"hljs-built_in"},[s._v("Function")]),s._v(".prototype.after = "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("fn")]),s._v(") ")]),s._v("{\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" self = "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(";\n  "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" ret = self.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (ret === "),t("span",{staticClass:"hljs-string"},[s._v('"nextSuccessor"')]),s._v(") {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" fn.apply("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),t("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(");\n    }\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" ret;\n  }\n}\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" order = order500.after(order200).after(orderNormal);\n\n"),t("span",{staticClass:"hljs-comment"},[s._v("//开始发起请求")]),s._v("\norder("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(");\norder("),t("span",{staticClass:"hljs-number"},[s._v("2")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(");\norder("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(");\norder("),t("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(", "),t("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", "),t("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(");\n")])])]),t("h2",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),t("p",[s._v("无论是作用域链、原型链，还是DOM节点中的事件冒泡，我们都能从中找到职责链模式的影子。"),t("br"),s._v("\n职责链模式可以很好地帮助我们管理代码，降低发起请求的对象和处理请求的对象之间的耦合性。职责链中的节点数量和顺序是可以自由变化的，我们可以在运行时决定链中包含哪些节点。")])])}),[],!1,null,null,null);a.default=l.exports}}]);